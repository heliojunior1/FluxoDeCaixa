{% extends 'base.html' %}
{% block content %}

<!-- Alertas de Gestão - Colapsável no Topo -->
{% if alertas %}
<div class="mb-6">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <!-- Header Colapsável -->
        <button onclick="toggleAlertas()"
            class="w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors text-left">
            <div class="flex items-center gap-3">
                <i data-lucide="alert-triangle"
                    style="color: var(--sefaz-primary-blue); width: 20px; height: 20px;"></i>
                <span class="font-semibold text-gray-700">Alertas de Gestão</span>
                <span class="px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-700 rounded-full">
                    {{ alertas|length }} {% if alertas|length == 1 %}alerta{% else %}alertas{% endif %}
                </span>
            </div>
            <i id="alertas-icon" data-lucide="chevron-down" style="color: #6b7280; width: 20px; height: 20px;"></i>
        </button>

        <!-- Conteúdo dos Alertas (Colapsado por padrão) -->
        <div id="alertas-content" class="hidden border-t border-gray-200">
            <div class="p-4 space-y-2">
                {% for alerta in alertas %}
                <div
                    class="alert-card alert-{{ alerta.severidade.lower() }} px-4 py-3 rounded-lg border-l-4 flex items-center justify-between gap-4 shadow-sm hover:shadow transition-shadow">
                    <!-- Conteúdo Principal -->
                    <div class="flex items-center gap-3 flex-grow min-w-0">
                        <!-- Tag de Categoria -->
                        <span
                            class="inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded categoria-{{ alerta.categoria.lower().replace('_', '-') }} flex-shrink-0">
                            {% if alerta.severidade == 'CRITICAL' %}
                            <i data-lucide="alert-octagon" style="width: 12px; height: 12px;"></i>
                            {% elif alerta.severidade == 'WARNING' %}
                            <i data-lucide="alert-triangle" style="width: 12px; height: 12px;"></i>
                            {% else %}
                            <i data-lucide="info" style="width: 12px; height: 12px;"></i>
                            {% endif %}
                            {{ alerta.categoria.replace('_', ' ') }}
                        </span>

                        <!-- Mensagem -->
                        <p class="text-gray-800 text-sm leading-tight truncate">{{ alerta.mensagem }}</p>
                    </div>

                    <!-- Ação -->
                    <form method="post" action="{{ url_for('marcar_alerta_lido_route', seq=alerta.seq_alerta_gerado) }}"
                        class="flex-shrink-0">
                        <button type="submit"
                            class="p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors"
                            title="Marcar como lido">
                            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                        </button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Menu de Navegação -->
<h3 class="text-xl font-semibold text-gray-700 mb-4">Módulos do Sistema</h3>
<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
    <a href="{{ url_for('relatorios') }}" class="nav-card">
        <div
            class="h-full bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-lg hover:border-blue-400 transition-all text-center flex flex-col justify-center items-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full"
                style="background-color: #E7F1FA;"><i data-lucide="layout-dashboard"
                    style="color: var(--sefaz-primary-blue);"></i></div>
            <p class="mt-4 font-semibold text-gray-700 h-12 flex items-center justify-center">Relatórios</p>
        </div>
    </a>
    <a href="{{ url_for('saldos') }}" class="nav-card">
        <div
            class="h-full bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-lg hover:border-blue-400 transition-all text-center flex flex-col justify-center items-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full"
                style="background-color: #E7F1FA;"><i data-lucide="dollar-sign"
                    style="color: var(--sefaz-primary-blue);"></i></div>
            <p class="mt-4 font-semibold text-gray-700 h-12 flex items-center justify-center">Saldos</p>
        </div>
    </a>
    <a href="{{ url_for('projecoes_menu') }}" class="nav-card">
        <div
            class="h-full bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-lg hover:border-blue-400 transition-all text-center flex flex-col justify-center items-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full"
                style="background-color: #E7F1FA;"><i data-lucide="trending-up"
                    style="color: var(--sefaz-primary-blue);"></i></div>
            <p class="mt-4 font-semibold text-gray-700 h-12 flex items-center justify-center">Projeções</p>
        </div>
    </a>
    <!-- Extrato Bancário card removed: replaced by Saldos por Conta report -->
    <a href="{{ url_for('mapeamentos') }}" class="nav-card">
        <div
            class="h-full bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-lg hover:border-blue-400 transition-all text-center flex flex-col justify-center items-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full"
                style="background-color: #E7F1FA;"><i data-lucide="route" style="color: var(--sefaz-primary-blue);"></i>
            </div>
            <p class="mt-4 font-semibold text-gray-700 h-12 flex items-center justify-center">Mapeamentos</p>
        </div>
    </a>
    <a href="{{ url_for('qualificadores') }}" class="nav-card">
        <div
            class="h-full bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-lg hover:border-blue-400 transition-all text-center flex flex-col justify-center items-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full"
                style="background-color: #E7F1FA;"><i data-lucide="tags" style="color: var(--sefaz-primary-blue);"></i>
            </div>
            <p class="mt-4 font-semibold text-gray-700 h-12 flex items-center justify-center">Qualificadores</p>
        </div>
    </a>
    <a href="{{ url_for('alertas') }}" class="nav-card">
        <div
            class="h-full bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-lg hover:border-blue-400 transition-all text-center flex flex-col justify-center items-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full"
                style="background-color: #E7F1FA;"><i data-lucide="bell" style="color: var(--sefaz-primary-blue);"></i>
            </div>
            <p class="mt-4 font-semibold text-gray-700 h-12 flex items-center justify-center">Alertas</p>
        </div>
    </a>
    <!-- Moved to end: Pagamentos and Conferência -->
    <a href="{{ url_for('pagamentos') }}" class="nav-card">
        <div
            class="h-full bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-lg hover:border-blue-400 transition-all text-center flex flex-col justify-center items-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full"
                style="background-color: #E7F1FA;"><i data-lucide="credit-card"
                    style="color: var(--sefaz-primary-blue);"></i></div>
            <p class="mt-4 font-semibold text-gray-700 h-12 flex items-center justify-center">Pagamentos</p>
        </div>
    </a>
    <a href="{{ url_for('conferencia') }}" class="nav-card">
        <div
            class="h-full bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-lg hover:border-blue-400 transition-all text-center flex flex-col justify-center items-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full"
                style="background-color: #E7F1FA;"><i data-lucide="check-check"
                    style="color: var(--sefaz-primary-blue);"></i></div>
            <p class="mt-4 font-semibold text-gray-700 h-12 flex items-center justify-center">Conferência</p>
        </div>
    </a>
</div>

<style>
    /* Estilos para os alertas - Design Compacto e Sutil */
    .alert-card {
        transition: all 0.15s ease;
    }

    /* Severidades - Cores mais sutis */
    .alert-critical {
        background-color: #fef2f2;
        border-left-color: #dc2626;
    }

    .alert-warning {
        background-color: #fffbeb;
        border-left-color: #f59e0b;
    }

    .alert-info {
        background-color: #eff6ff;
        border-left-color: #3b82f6;
    }

    /* Tags de Categoria - Compactas */
    .categoria-receita {
        background-color: #dcfce7;
        color: #15803d;
    }

    .categoria-despesa-pessoal {
        background-color: #fee2e2;
        color: #b91c1c;
    }

    .categoria-saldo {
        background-color: #dbeafe;
        color: #1d4ed8;
    }

    .categoria-orcamento {
        background-color: #fef3c7;
        color: #a16207;
    }

    /* Animação suave para expansão/colapso */
    .alertas-expanded {
        animation: slideDown 0.2s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<script>
    function toggleAlertas() {
        const content = document.getElementById('alertas-content');
        const icon = document.getElementById('alertas-icon');

        if (content.classList.contains('hidden')) {
            content.classList.remove('hidden');
            content.classList.add('alertas-expanded');
            icon.setAttribute('data-lucide', 'chevron-up');
        } else {
            content.classList.add('hidden');
            content.classList.remove('alertas-expanded');
            icon.setAttribute('data-lucide', 'chevron-down');
        }

        // Re-render lucide icons
        if (window.lucide) {
            lucide.createIcons();
        }
    }
</script>
{% endblock %}